<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>NFC Testing - Browser API</title>
  </head>
  <body>
    <h1></h1>
    <button onclick="location.href = (location.href.split('?')[0] + '?' + Date.now() )">Refresh</button>

    <hr>
    <div id="logger" style="border: 1px"></div>

    <script>
      function listenNFCData () {

        if (!("NDEFReader" in window))
        {
          console.log("Web NFC is not available. Use Chrome on Android.");
          return ;
        }

        console.log ( '===== Start NFC Listening =====' ) ;
        try {

          const reader = new NDEFReader() ;

          reader.addEventListener ( 'readingerror', (e) => { 
            console.log("Argh! Cannot read data from the NFC tag. Try another one?") ; 
            console.log(e) ; 
          } );

          reader.addEventListener ( 'reading', ({ message, serialNumber }) => {
            console.log(message) ;
            console.log('S/N: ' + serialNumber) ;
            console.log(`> Records: (${message.records.length})`);
          } ) ;

          console.log(' * Reader Ready');
          
        } catch (error) {console.log(error);}
      }

      function initLogger() {

        const originalConsoleLogFunction = console.log;
        const logger = document.getElementById('logger');

        console.log = function ( message ) {
          if (typeof message == 'object')
          { logger.innerHTML += (JSON && JSON.stringify ? JSON.stringify(message) : message) + '<br />'; }
          else
          { logger.innerHTML += message + '<br />'; }

          originalConsoleLogFunction (message);
        }
      }


      function init ()
      {
        document.getElementsByTagName('h1')[0].innerText = document.getElementsByTagName('title')[0].innerText ;


        initLogger();
        listenNFCData();
      }


      init ();
    </script>
  </body>
</html>
